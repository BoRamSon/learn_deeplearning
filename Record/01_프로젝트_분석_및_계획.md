# 🟩 CNN-LSTM 모델 훈련 프로젝트 분석 및 계획

## 📋 프로젝트 개요
- **목표**: 제조업 안전사고 예방을 위한 컴퓨터 비전 모델 개발
- **데이터셋**: AI허브 "스마트 제조 시설 안전 감시를 위한 데이터"
- **모델**: CNN-LSTM (pranoyr/cnn-lstm 저장소 활용)
- **개발환경**: Windows, NVIDIA GeForce GTX 1650, Python 3.11, uv 패키지 관리자

## 🔍 현재 상황 분석

### 1. 프로젝트 폴더 구조
```
human-accident/
├── data/
│   └── safety-data/
│       └── human-accident/
│           ├── bump/           # 충돌 사고 비디오 (136개 파일)
│           ├── fall-down/      # 넘어짐 사고
│           ├── fall-off/       # 추락 사고
│           ├── hit/           # 타격 사고
│           ├── jam/           # 끼임 사고
│           └── no-accident/   # 정상 상황
├── cnn-lstm/                  # 클론된 모델 저장소
│   ├── main.py               # 메인 훈련 스크립트
│   ├── opts.py               # 커맨드라인 옵션 정의
│   ├── models/cnnlstm.py     # CNN-LSTM 모델 아키텍처
│   ├── dataset.py            # 데이터셋 로더
│   └── datasets/ucf101.py    # UCF101 데이터셋 클래스
└── 30_model_training.ipynb   # 현재 작업 중인 노트북
```

### 2. 데이터 형태 분석
- **현재 데이터**: `.avi` 비디오 파일들이 클래스별 폴더에 저장
- **모델 요구사항**: 프레임 이미지들 (`image_00001.jpg`, `image_00002.jpg`, ...)
- **필요한 작업**: 비디오 → 프레임 이미지 변환 및 어노테이션 파일 생성

### 3. CNN-LSTM 모델 구조 이해
```python
class CNNLSTM(nn.Module):
    def __init__(self, num_classes=2):
        # ResNet-101 (사전훈련) → 300차원 특징 추출
        self.resnet = resnet101(pretrained=True)
        self.resnet.fc = nn.Sequential(nn.Linear(self.resnet.fc.in_features, 300))
        
        # LSTM: 300 → 256 (3 레이어)
        self.lstm = nn.LSTM(input_size=300, hidden_size=256, num_layers=3)
        
        # 분류기: 256 → 128 → num_classes
        self.fc1 = nn.Linear(256, 128)
        self.fc2 = nn.Linear(128, num_classes)
```

## 📝 해결해야 할 주요 문제점

### 1. 데이터 형태 불일치
- **문제**: 현재 `.avi` 비디오 파일, 모델은 프레임 이미지 기대
- **해결방안**: FFmpeg를 사용한 비디오 → 프레임 변환 스크립트 작성

### 2. 어노테이션 파일 부재
- **문제**: UCF101 형식의 JSON 어노테이션 파일 필요
- **해결방안**: 사용자 데이터에 맞는 어노테이션 파일 생성

### 3. 클래스 수 불일치
- **문제**: 모델 기본값 400클래스, 사용자 데이터는 6클래스
- **해결방안**: `--n_classes 6` 옵션으로 설정

### 4. 데이터셋 로더 수정 필요
- **문제**: UCF101 전용 데이터셋 클래스
- **해결방안**: 사용자 데이터에 맞는 커스텀 데이터셋 클래스 작성

## 🎯 단계별 실행 계획

### Phase 1: 데이터 전처리
1. 비디오 → 프레임 이미지 변환 스크립트 작성
2. 어노테이션 JSON 파일 생성
3. 데이터셋 구조 UCF101 형식으로 재구성

### Phase 2: 모델 설정 수정
1. 클래스 수를 6개로 변경
2. 커스텀 데이터셋 클래스 작성
3. 훈련/검증 데이터 분할 설정

### Phase 3: 훈련 실행
1. 소규모 테스트 실행 (배치 크기 작게)
2. 하이퍼파라미터 조정
3. 본격적인 훈련 실행

### Phase 4: 모니터링 및 평가
1. TensorBoard로 훈련 과정 모니터링
2. 체크포인트 저장 및 관리
3. 모델 성능 평가

## 🔧 필요한 도구 및 라이브러리
- FFmpeg (비디오 프레임 추출)
- OpenCV (이미지 처리)
- PyTorch, torchvision (딥러닝)
- TensorBoard (훈련 모니터링)

## 📊 예상 클래스 구성
1. `bump` - 충돌 사고
2. `fall-down` - 넘어짐 사고  
3. `fall-off` - 추락 사고
4. `hit` - 타격 사고
5. `jam` - 끼임 사고
6. `no-accident` - 정상 상황

---
**작성일**: 2025-09-16  
**다음 단계**: 비디오 → 프레임 변환 스크립트 작성
